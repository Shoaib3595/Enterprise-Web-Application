package com.iit.ewa.groceryhub.service;

import com.google.gson.Gson;
import com.google.gson.reflect.TypeToken;
import com.iit.ewa.groceryhub.entity.Grocery;
import com.iit.ewa.groceryhub.entity.GroceryReview;
import com.iit.ewa.groceryhub.entity.Stores;
import com.iit.ewa.groceryhub.model.ChartPoint;
import com.iit.ewa.groceryhub.model.ReviewFilter;
import com.iit.ewa.groceryhub.repository.*;
import com.iit.ewa.groceryhub.security.UserSessionService;
import lombok.AllArgsConstructor;
import lombok.extern.slf4j.Slf4j;

import org.springframework.data.domain.Sort;
import org.springframework.data.mongodb.core.MongoTemplate;
import org.springframework.data.mongodb.core.query.Criteria;
import org.springframework.data.mongodb.core.query.Query;
import org.springframework.stereotype.Service;

import java.io.Serializable;
import java.lang.reflect.Type;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.time.temporal.ChronoUnit;
import java.util.*;
import java.util.stream.Collectors;
import java.util.stream.Stream;
import java.net.InetAddress;
import java.net.UnknownHostException;

import static java.time.temporal.ChronoUnit.DAYS;

@Service
@AllArgsConstructor
@Slf4j
public class GroceryService {
    private GroceryRepository groceryRepository;
    private StoreRepository storeRepository;
    private OrderRepository orderRepository;
    private GroceryReviewRepository reviewRepository;
    private UserSessionService sessionService;
    private UserInfoRepository userInfoRepository;

    private MongoTemplate mongoTemplate;

    final DateTimeFormatter formatter = DateTimeFormatter.ofPattern("dd-MM-yyyy");

    final String demoData = "[{\"id\":1,\"category\":\"Beverages\",\"description\":\"https://www.amazon.com/Minute-Premium-Fruit-Punch-Fluid/dp/B00867XLDM/ref=sr_1_1_0o_fs?keywords=Minute+Maid%2C+Premium+Berry+Punch&qid=1637626713&sr=8-1#:~:text=Minute%20Maid%20%27%20Fruit,of%20Vitamin%20C.\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/912vWQE287L._AC_UL320_.jpg\\n\",\"name\":\"Minute Maid, Premium Berry Punch\",\"price\":1.5,\"rating\":4},{\"id\":2,\"category\":\"Beverages\",\"description\":\"https://www.amazon.com/Red-Bull-Energy-Drink-Sugarfree/dp/B006MB7M6G/ref=sr_1_3?keywords=beverages&qid=1637627037&sr=8-3#:~:text=RED%20BULL%20GIVES,carbohydrates%20and%20protein.\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/71z86Iyp4PS._AC_UL320_.jpg\",\"name\":\"Red Bull Energy Drink Sugar Free \",\"price\":58.86,\"rating\":5},{\"id\":3,\"category\":\"Beverages\",\"description\":\"BODYARMOR is the sports drink for today’s athlete, providing Superior Hydration by combining natural flavors & sweeteners, no colors from artificial sources and potassium-packed electrolytes.\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/71uRlW14F4L._AC_UL320_.jpg\",\"name\":\"Gatorade Original Thirst\",\"price\":11.96,\"rating\":5},{\"id\":4,\"category\":\"Beverages\",\"description\":\"Featuring everyone’s favorite flavors together in one place, the Sparkling Ice Purple Pack (Black Raspberry, Cherry Limeade, Orange Mango, and Kiwi Strawberry) includes four refreshing, zero-sugar flavors to keep you hydrated and happy. Sparkling Ice is a fizzy, flavorful sparkling water, without all the calories. Sparkling Ice flavored sparkling water contains 0g sugar, only 5 calories per bottle, and 0g carbs. Made with better-for-you ingredients, this low-calorie carbonated water is bursting with real fruit flavor, is made with colors from natural sources, and contains vitamins and antioxidants. The product ships in a pack of 12 bottles. Each sparkling water bottle contains 17 fl oz.\",\"discount\":0,\"imageUrl\":\"https://www.amazon.com/Sparkling-Ice-Variety-Pack-Fl/dp/B00F9VCQ2A/ref=sr_1_4?keywords=beverages&qid=1637627037&sr=8-4\",\"name\":\"Sparkling Ice Purple Variety Pack\",\"price\":9.98,\"rating\":5},{\"id\":5,\"category\":\"Beverages\",\"description\":\"The one and only. With a legacy over 50 years in the making, it’s the most scientifically researched and game-tested way to replace electrolytes lost in sweat.INGREDIENTS : WATER, SUGAR, DEXTROSE, CITRIC ACID, SALT, SODIUM CITRATE, MONOPOTASSIUM PHOSPHATE, MODIFIED FOOD STARCH, NATURAL FLAVOR, RED 40, GLYCEROL ESTER OF ROSIN, CARAMEL COLOR\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/812uU6XQOWL._AC_UL320_.jpg\",\"name\":\"Gatorade Classic Thirst Quencher\",\"price\":13.99,\"rating\":3},{\"id\":6,\"category\":\"Beverages\",\"description\":\"An energy drink you can feel good about: V8 +Energy sparkling black cherry is a healthy energy drink that's made from fruit, vegetables, and tea. Containing the same amount of caffeine as leading energy drinks (80 mg) that's instead sourced from tea, V8 +Energy sparkling is a healthy alternative for steady energy. Black and green tea provide natural caffeine while supplying the body with C and B vitamins, to create a smoother and healthier transition to your steady energy boost. That natural energy is infused into a blend of sweet potato and apple juices with black cherry Flavor to make a delicious sparkling Energy drink. Add it to any well-balanced diet for a restorative boost and the perfect pick-me-up. Plus, each can has no added sugar, has no Colors from Artificial sources, and is just 50 calories. V8 +Energy sparkling black cherry is the perfect refreshing boost to keep you going!\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/91ex8QVefcL._AC_UL320_.jpg\",\"name\":\"V8 Sparkling +Energy, Healthy Energy Drink, Natural Energy from Tea\",\"price\":15.48,\"rating\":5},{\"id\":7,\"category\":\"Beverages\",\"description\":\"Live Stress Free!\\n\\nWhen we set out to create Zenify, we wanted something you could drink throughout the day, without any side effects. A drink that would reduce stress, but also keep you sharp, focused, creative and production.\\n\\nWe believe that people can only progress when we’re free of the stress that leads to polarization and intolerance.\\n\\nZenify Zero is made with the same natural and robust ingredients as Zenify Original with one distinction – stevia! Stevia is a natural, plant-based sweetener that is a non-caloric, sugar substitute. Just like Zenify Original, Zenify Zero is infused with the same stress-relieving antioxidants found in 25 cups of green tea with no caffeine. Both products are uniquely formulated to safely reduce stress with no harmful side effects.\\n\\nLike its counterpart, Zenify Zero includes a proprietary blend of l-theanine, GABA and glycine, clinically shown to increase alpha waves in the brain, elevate serotonin and dopamine levels and relieve stress without drowsiness.\\n\\nIngredients: Sparkling Water, Erythritol, Natural Flavor, Magnesium Lactate, Ascorbic Acid(Vitamin C), Stevia Extract, Monk Fruit Extract, Niacinamide(B3), Calcium Panthothenate(B5), Pyridoxine HCL(B6), Beta Carotene, Methylcobalamin(B12).\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/714+LRGIlPL._AC_UL320_.jpg\",\"name\":\"Zenify\",\"price\":2,\"rating\":5},{\"id\":8,\"category\":\"Beverages\",\"description\":\"FULL MEAL REPLACEMENT RTD. Contains all the nutrients your body needs to be healthy. 42 essential nutrients total. Plant based. Ideal superfood for breakfast. Ready to drink. Tastes delicious.\\nA COMPLETE VEGAN PROTEIN. High-protein. Each serving delivers 17 g of protein from 6 sources: isolated soy protein, isolated pea protein, oat protein, hemp protein, rice protein, and algae protein. This delivers a balanced spectrum of amino acids.\",\"discount\":20,\"imageUrl\":\"https://m.media-amazon.com/images/I/81YyDDzUy9L._AC_UL320_.jpg\",\"name\":\"ManaDrink\",\"price\":0.2,\"rating\":2},{\"id\":9,\"category\":\"Beverages\",\"description\":\"Our Mocha Cold Brew Coffee blends creamy almondmilk and 100% Direct Trade Arabica Bean with a little bit of chocolate and a whole lot of deliciousness at just 90 calories. \",\"discount\":10,\"imageUrl\":\"https://m.media-amazon.com/images/I/71ASepZ17ML._AC_UL320_.jpg\",\"name\":\"Califia Farms - Cold Brew Coffee\",\"price\":5.68,\"rating\":5},{\"id\":10,\"category\":\"Beverages\",\"description\":\"An excellent source of protein, deliciously smooth and creamy Koia Plant Protein Drink is ideal as a quick, on-the-go breakfast, post-workout boost, or afternoon snack. The craveable Cacao Bean ready-to-drink beverage powers your day with a high protein-to-sugar ratio – 19 grams of plant-powered protein and only 4 grams of sugar.\\n\\nStarting with an almond milk base, Koia blends in a proprietary mix of brown rice, pea, and hemp proteins, then adds a touch of organic cane sugar and monk fruit to deliver the positive power of plants without adding the things you usually see – like tons of sugar or artificial ingredients.\\n\\nA great fit for healthy, active lifestyles, Koia beverages are vegan, free of soy, dairy, and gluten, high in fiber, Kosher, and non-GMO. Koia Cacao Bean has 180 calories, 5 grams of fat, and 10 grams of fiber (15 grams of total carbohydrates).\\n\\nReady to go wherever you roam, Koia is also a great addition to your morning coffee as a creamer substitute. Harness Koia's great taste and clean, plant-powered nutrition in healthy recipes from oatmeal and Chia seed pudding to smoothie bowls and more.\\n\\nDeveloped with the belief that people should expect more from their protein beverage, Koia is dedicated to innovating with unexpected sources of protein, preserving the positive energy of plants, and reducing the things people don't want in a protein drink – hidden calories, excess sugars, and artificial ingredients.\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/61bB0tHu3fL._AC_UL320_.jpg\",\"name\":\"Koia Protein - Ready To Drink Plant Protein Shake\",\"price\":3.34,\"rating\":2},{\"id\":11,\"category\":\"Breads and Bakery\",\"description\":\"Special Shabbat Dessert: Our braided brioche is a delight that nobody should miss. Extremely soft and buttery, this bread brioche is made following the traditional challah recipe, so you and your family can enjoy a proper Shabbat together.\\nExcellent Taste: Each bite of our sweet challah has a buttery taste and a fluffy texture that only a traditional bakery can provide. Because each roll is baked fresh, each loaf is soft and has an excellent flavor that nobody can resist.\\nWhat You Get: Our pack includes 2 pieces of round challah bread, each weighing one pound. One of the challah bread rolls included is covered in sesame while the other one is plain so you get to enjoy the flavor of both.\\nAuthentic Recipe: The challah bread rolls are made with a mix of flour, sugar, salt, yeast, eggs, and natural flavors. The challah bread is free from GMOs, high fructose corn syrup, dairy, artificial flavoring or sweeteners.\\nThe challah bread loaf is a great delight for anyone but it was specifically prepared for any special Shabbat dinner. That is why our delight bread is Kosher and ready to be enjoyed by the whole family.\",\"discount\":15,\"imageUrl\":\"https://m.media-amazon.com/images/I/71hj1rguxTL._AC_UL320_.jpg\",\"name\":\"Mamas Bakery Challah Bread\",\"price\":12.25,\"rating\":1},{\"id\":12,\"category\":\"Breads and Bakery\",\"description\":\"TRADITIONAL CHALLAH ROLLS TO ENHANCE YOUR HOLIDAY OR SHABBAT TABLE! Celebrate Shabbat or any party with Stern's kosher braided challah rolls! There are 2 packages with 6 delicious oven-fresh bakery challah rolls included per pack.\\nCHALLAH ROLLS MADE WITH THE FINEST INGREDIENTS! At Stern's Bakery, we combine the perfect ratio of freshly sifted flour, sugar, whole eggs, and yeast to create premium egg challah rolls that tastes better than any bread you've ever tasted!\\nAT STERN'S WE BAKE FROM THE HEART! That's why our motto is always fresh, always delicious! Our scrumptious challah rolls are certified kosher, dairy-free, and nut-free. ( Kosher Parve, Pas Yisroel & Kemach Yoshan )\\nBAKERY FRESH CHALLAH ROLLS AT YOUR DOORSTEP! Our tasty, fluffy challah rolls are baked fresh daily! We hand pack the challah rolls into a dedicated bread bag to preserve optimum quality and freshness. These rolls are ready to roll (no oven necessary), but they are extra-delicious after a few minutes in a warm oven.\\nA FAMILY-OWNED BAKERY FOR OVER A CENTURY! At Stern's Bakery, we've mastered the art of baking; preserving age-old techniques, and acquiring abundant knowledge and skills to offer you world-class challahs, bread, pastry snacks, and cakes!\",\"discount\":20,\"imageUrl\":\"https://m.media-amazon.com/images/I/71+2v8wsTUL._AC_UL320_.jpg\",\"name\":\"Stern's Bakery Traditional Kosher Braided Challah\",\"price\":24.99,\"rating\":3},{\"id\":13,\"category\":\"Breads and Bakery\",\"description\":\"Perfect for French toast\\nMade in Colorado\\nBeautifully hand Braided\",\"discount\":50,\"imageUrl\":\"https://m.media-amazon.com/images/I/71XNRCPsvuL._AC_UL320_.jpg\",\"name\":\"Izzio Bread Challah Braid\",\"price\":6.12,\"rating\":4},{\"id\":14,\"category\":\"Breads and Bakery\",\"description\":\"We bake a slice of history into every loaf of our sourdough\\nWe use a portion of the original mother dough we've nurtured for over 150 years to start each and every batch.\\nIt takes up to 48 hours here in the San Francisco fog to bake our handcrafted loaves.\\nWe ship your bread the same day it's baked to get our bread to you faster and fresher.\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/613GKu5RzaL._AC_UL320_.jpg\",\"name\":\"San Francisco Boudin Bakery Sourdough Sampler\",\"price\":25.95,\"rating\":2},{\"id\":15,\"category\":\"Breads and Bakery\",\"description\":\"Freshness Guaranteed - Our plastic bread bags will keep away the moisture and keep odor out; Keeping your bread fresh and tasty longer; Includes 100PCS/pack with sturdy gold-colored twisted ties to keep the bag airtight.\\nFor all Loaf Sizes - Each of our bread storage bags measures 8x4x18 inches; Perfect for all types and sizes of bread and other bakery items such as bagels, sourdough, muffins, and buns.\\nClear Bags - Made up of low-density polyethylene, which makes them transparent; Making the bread look more tantalizing and fresher; Helps spot any molds, insects, or bugs in the wrapping.\\nRecyclable - Unlike other homemade bread bags, our product is recyclable; reuse in grocery bags, cereal box liners, paper towels, and much more.\\nPerfect Treat for Bakers - Our bread loaf bags are an essential item for home bakers, bread enthusiasts, and bakery owners; It is also widely used in the food services industry, making it a complementary thing for baking; It is a perfect choice for baking loaves, buns, bagels, muffins, croissants and much more.\",\"discount\":45,\"imageUrl\":\"https://m.media-amazon.com/images/I/811w-B3egyL._AC_UL320_.jpg\",\"name\":\"Bread Bag for Homemade Bread\",\"price\":12.89,\"rating\":5},{\"id\":16,\"category\":\"Breads and Bakery\",\"description\":\"Paleo and Keto Friendly, Low Carb, Gluten Free, Grain Free, Soy Free, Non GMO\\nPaleo Thin Variety (Almond, Coconut and Seed Medley Bread)\\nMakes Excellent Toast and Sandwiches\\nWill last up to 3-5 days in the fridge, MUST FREEZE, will last up to 12 months in Freezer (Gluten Free, GMO-Free & Grain Free)\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/71IYfKC4acL._AC_UL320_.jpg\",\"name\":\"Julian Bakery Paleo Thin Bread\",\"price\":39.99,\"rating\":1},{\"id\":17,\"category\":\"Breads and Bakery\",\"description\":\"Our flaky and crunchy Mini Palmiers are made with real butter, and they are lightly dusted with sugar for a golden brown finish.\\nMade from scratch with no preservatives or trans fat\\nLa Monarca Bakery products are made with top quality, fresh ingredients. We have been consistently recognized in 'Best of L.A.'\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/71b-CEFcLZL._AC_UL320_.jpg\",\"name\":\"Orejitas - Flaky and Crunchy Mini Palmiers\",\"price\":14,\"rating\":1},{\"id\":18,\"category\":\"Breads and Bakery\",\"description\":\"An excellent source of Fiber and Low in Fat\\nAn excellent source of Fiber and Low in Fat\\nA Great Choice for Anyone Trying to Limit Their Carbs\\nONLY 40 Calories per Slice!\\nAn Easy Choice for Anyone on the Keto Diet\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/71bJ+b-ly0L._AC_UL320_.jpg\",\"name\":\"White Keto Bread - Zero NET Carbs - Keto Diet\",\"price\":24.14,\"rating\":1},{\"id\":19,\"category\":\"Breads and Bakery\",\"description\":\"Bake-At-Home Sourdough 3 Large Loaves\\nUSDA Organic Non GMO Project Verified\\nNo freezing, no preservatives. Unopened, this loaf will stay fresh for weeks until you are ready!\\nUnlike other breads, our package allows you to keep the unopened bread fresh\\n18.2 ounce loaf, 3 count\",\"discount\":70,\"imageUrl\":\"https://m.media-amazon.com/images/I/71mC+DtY1hL._AC_UY218_.jpg\",\"name\":\"Bake-At-Home Organic Sourdough 3 Loaves\",\"price\":12.89,\"rating\":2},{\"id\":20,\"category\":\"Breads and Bakery\",\"description\":\"Roasted, golden sesame seeds atop oven toasted breadsticks\\nLight and crispy breadsticks made with simple ingredients\\nPerfect alongside salads, soups, and pasta\\nApproximately 17 bread sticks per package\\nKosher\",\"discount\":60,\"imageUrl\":\"https://m.media-amazon.com/images/I/71GipMpaFFL._AC_UL320_.jpg\",\"name\":\"Stella D'oro, Breadsticks Sesame, 6 Ounce\",\"price\":4.45,\"rating\":2},{\"id\":21,\"category\":\"Dairy, Cheese and Eggs\",\"description\":\"Real Butter\\nGluten Free\\nKosher\\nHalal\\nNo Oils\",\"discount\":15,\"imageUrl\":\"https://m.media-amazon.com/images/I/71XAUtKMH6L._AC_UL320_.jpg\",\"name\":\"Chef Shamy Garlic Butter\",\"price\":10.49,\"rating\":5},{\"id\":22,\"category\":\"Dairy, Cheese and Eggs\",\"description\":\"Shaker top jar\\nHighest quality grated Italian cheese products\\nQuality and consistency in every jar\\nAll crafted cheeses are 100% guaranteed\",\"discount\":10,\"imageUrl\":\"https://m.media-amazon.com/images/I/81CnwVntkLL._AC_UL320_.jpg\",\"name\":\"Milano's Parmesan Cheese Jars\",\"price\":5.72,\"rating\":5},{\"id\":23,\"category\":\"Dairy, Cheese and Eggs\",\"description\":\"UPGRADE ANY RECIPE: Replace your current butter, olive oil, coconut oil or other cooking oil 1:1 with ghee.\\nDIET FRIENDLY: Great addition to any diet – Certified Keto, Paleo, Gluten Free, Ayurvedic, Whole 30, and FODMAP friendly.\\nWE SOURCE THE BEST: Our lactose-free ghee comes from grass-fed, pasture-raised, antibiotic and hormone free New Zealand cows.\\nNO SHORTCUTS: Our ghee is made the old-fashioned way and spreadable at room temperature. No refrigeration required.\\nHELPFUL NOTE: Ghee may liquefy during shipping, but will re-solidify within a few hours of refrigeration, or overnight at room temperature.\\n100% RECYCLABLE PLASTIC: Bye bubble wrap, hello better packaging. We made the switch to reduce our carbon footprint overall. It's still the same ghee you know and love!\",\"discount\":12,\"imageUrl\":\"https://m.media-amazon.com/images/I/91HjBAuKXRL._AC_UL320_.jpg\",\"name\":\"4th & Heart Original Grass-Fed Ghee\",\"price\":14.99,\"rating\":4},{\"id\":24,\"category\":\"Dairy, Cheese and Eggs\",\"description\":\"ADD ALMONDMILK TO YOUR PANTRY: Unsweetened vanilla almondmilk tastes great in baking recipes, mixed with coffee, or on its own\\nSHELF-STABLE: Comes in special packaging for convenient, non-refrigerated storage.State of Readiness: Ready to Drink\\nDELICIOUSLY WHOLESOME: Dairy-, lactose-, and casein-free; absolutely no added sugar, soy, gluten, eggs, or MSG\\nA NUTRITIONAL ALL-STAR: 50% more calcium than dairy milk*; an excellent source of vitamin E; zero cholesterol; 0g saturated fat per serving; just 30 calories per serving\\nNON-GMO PROJECT VERIFIED, VEGAN-FRIENDLY ALMONDMILK with no artificial colors or flavors\",\"discount\":80,\"imageUrl\":\"https://m.media-amazon.com/images/I/91xdLMdIdbL._AC_UL320_.jpg\",\"name\":\"Silk Shelf-Stable Almond Milk, Unsweetened Vanilla\",\"price\":2.89,\"rating\":3},{\"id\":25,\"category\":\"Dairy, Cheese and Eggs\",\"description\":\"Made in a facility that also makes wheat products\\n1 Pound Jar Butter Powder, packaged in plastic jar and sealed for freshness\\n72% fat, GMO FREE, A Product of USA\\nMix ratio 1:1\\nOur butter powder is perfect for Soups, Sauces and Mixes - Replace churned butter, Hoosier Hill Farm brand .. satisfaction is guaranteed\\nHoosier Hill Farm is located in America's heartland of northeast Indiana. Our products and ingredients are guaranteed fresh and we are proud of our heritage and good, old-fashioned values\",\"discount\":50,\"imageUrl\":\"https://m.media-amazon.com/images/I/71UB5OvSWEL._AC_UL320_.jpg\",\"name\":\"Hoosier Hill Farm Real Butter powder\",\"price\":10.99,\"rating\":4},{\"id\":26,\"category\":\"Dairy, Cheese and Eggs\",\"description\":\"One, 12 oz. Resealable stand up bag (0.75 lbs.)\\nGluten Free; Vegan; Vegetarian; Paleo Friendly; Kosher Pareve\\nManufactured in a dedicated gluten free facility; R5-ELISA tested gluten free\\nGreat for vegan baking\\nEasy to use: just add water\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/814-SVd3wNL._AC_UL320_.jpg\",\"name\":\"Bob's Red Mill, Egg Substitute\",\"price\":3.99,\"rating\":5},{\"id\":27,\"category\":\"Dairy, Cheese and Eggs\",\"description\":\"Contains 6 Packs/4 Count 8-Ounce Single Serve Boxes of Almond Breeze Dairy Free Almondmilk, Chocolate\\nMade with real California almonds\\nFree from Dairy, Soy and Lactose\\nExcellent source of vitamins D and E, 50 percentage More Calcium than Milk\\nNon-GMO Project Verified\\n\",\"discount\":60,\"imageUrl\":\"https://m.media-amazon.com/images/I/91xn1Zi4xKL._AC_UL320_.jpg\",\"name\":\"Almond Breeze Dairy Free Almondmilk\",\"price\":24.39,\"rating\":3},{\"id\":28,\"category\":\"Dairy, Cheese and Eggs\",\"description\":\"100% Natural Cheese CRUNCHIFIED into the tastiest snack possible\\nAll the goodness of Cheese in a perfect on-the-go healthy snack - no refrigeration required!\\nHigh in Protein | All Natural | Gluten Free | Excellent source of Calcium | Low Carb | Keto Friendly\\nAllergen free from Peanuts, Soybeans, Eggs, Wheat, Sesame (Canada), Fish and Crustacean\\nMoon Cheese is a product of NutraDRIED, where we care about healthy snacking and are dedicated to creating products that taste great, naturally.\",\"discount\":15,\"imageUrl\":\"https://m.media-amazon.com/images/I/61Q+xh8UTAL._AC_UL320_.jpg\",\"name\":\"Moon Cheese \",\"price\":2.99,\"rating\":2},{\"id\":29,\"category\":\"Dairy, Cheese and Eggs\",\"description\":\"Non-Dairy Coffee Creamer ---- A delicious, dairy-free creamer alternative boosted with collagen nutrition.\\nEnergy-Boosting MCTs ---- Our Collagen Creamer includes 9g of Medium Chain Triglycerides (MCTs), a type of healthy fat found in coconut milk. It's great for energy production.** FYI, coconut is an excellent source of MCTs. That's also why it tastes like coconut.\\nKey Nutritional (per serving) ---- 10g of collagen per creamers. Our Collagen Creamer combines our signature grass-fed & pasture-raised bovine Collagen Peptides and energy-boosting MCTs for a delicious way to elevate your cup of joy, while supporting healthy hair, skin, nails & joints** as you go.\\nHealth Truth ---- Our collagen creamers are dairy-free, gluten-free, paleo friendly, keto friendly, whole30 approved, and free of any added sugars. You'll notice there is just 1g of sugar per serving that is found naturally in the coconut milk powder.\\nNow for the Delicious Goodness ---- Add our Collagen Creamer to coffee for a sweet addition to your morning routine or mix it into granola or cereal for a unique spin on your favorite breakfast staples.\",\"discount\":40,\"imageUrl\":\"https://m.media-amazon.com/images/I/71XefCbGCiL._AC_UL320_.jpg\",\"name\":\"Vital Proteins Collagen Coffee Creamer\",\"price\":12.49,\"rating\":1},{\"id\":30,\"category\":\"Dairy, Cheese and Eggs\",\"description\":\"71 Servings\\n5,760 Calories\\nPerfect for Food Storage, Emergencies, Survival, Camping, and Everyday Use!\\nCertified Gluten-Free\\nUp to a 10 Year Shelf Life!\",\"discount\":2,\"imageUrl\":\"https://m.media-amazon.com/images/I/81oMSfJ2uXL._AC_UL320_.jpg\",\"name\":\"Augason Farms Dried Whole Egg Product \",\"price\":35.99,\"rating\":5},{\"id\":31,\"category\":\"Frozen Foods\",\"description\":\"365 by Whole Foods Market products give you that dance-down-the-aisles feeling, virtual aisles too! Our huge range of choices with premium ingredients at prices you can get down with makes grocery shopping so much more than tossing the basics in your cart.\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/71XqWosbvlL._AC_UL320_.jpg\",\"name\":\"365 by Whole Foods Market\",\"price\":19.99,\"rating\":4},{\"id\":32,\"category\":\"Frozen Foods\",\"description\":\"One 25 oz package of Tyson Fully Cooked Southern Style Chicken Breast Tenderloins\\nAll-natural, minimally processed chicken raised with no antibiotics ever\\n13 grams of protein per serving\\n0 grams of trans fat per serving\\nFully cooked and ready in minutes\\nResealable bag for easy storage\",\"discount\":20,\"imageUrl\":\"https://m.media-amazon.com/images/I/81PiR5zZNRL._AC_UL320_.jpg\",\"name\":\"Tyson Fully Cooked Southern Style Breaded Chicken Breast\",\"price\":9.99},{\"id\":33,\"category\":\"Frozen Foods\",\"description\":\"One 12-ounce bag of whole Happy Belly Frozen Sweet Corn\\nA nutritious addition to your shopping list, our Sweet Corn are specially selected and quick-frozen to preserve flavor\\nAn excellent source of Vitamin C and good source of Fiber, they're a healthy complement to any meal or a fresh, green salad\\nSatisfaction Guarantee: We’re proud of our products. If you aren’t satisfied, we’ll refund you for any reason within a year of purchase. 1-877-485-0385\\nAn Amazon brand\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/81r4mD-ngmL._AC_UL320_.jpg\",\"name\":\"Happy Belly Frozen Sweet Corn\",\"price\":1.19,\"rating\":4},{\"id\":34,\"category\":\"Frozen Foods\",\"description\":\"One 12 count pack of Jimmy Dean Pancakes and Sausage on a Stick Frozen Breakfast\\nSavory sausage dipped in sweet pancake batter on a stick\\nJimmy Dean breakfast on a stick contains 6 grams of protein per serving\\nFrozen breakfast meal can be fully cooked and ready in minutes\\nEnjoy on its own or drizzled with maple syrup\",\"discount\":20,\"imageUrl\":\"https://m.media-amazon.com/images/I/91-MohRVarL._AC_UL320_.jpg\",\"name\":\"Jimmy Dean Pancakes and Sausage on a Stick\",\"price\":9.49,\"rating\":2},{\"id\":35,\"category\":\"Frozen Foods\",\"description\":\"HMR VEGETARIAN MEDLEY ENTREE VARIETY PACK includes 2 each of the following satisfying HMR Entrees: Cheese and Basil Ravioli, Pasta Fagioli, and Mushroom Risotto.\\nHMR ENTREES ARE A CONVENIENT AND NUTRITIOUS option to help you manage your weight. Delicious, filling entrees contain 10-14g of protein per serving.\\nREADY IN JUST A MINUTE. No refrigeration needed until opened.\\nDELICIOUS ENTREES contain 200-230 calories per serving.\\nGREAT ON THEIR OWN, but also mix well with vegetables and other HMR Entrees for a quick and filling meal. Foods shown with added vegetables.\",\"discount\":15,\"imageUrl\":\"https://m.media-amazon.com/images/I/71+z8loEtvL._AC_UL320_.jpg\",\"name\":\"HMR Vegetarian Medley Entree Variety Pack\",\"price\":23.7,\"rating\":5},{\"id\":36,\"category\":\"Frozen Foods\",\"description\":\"Marie Callender's Chicken Pot Pie frozen meal\\nThis easy to prepare frozen pie makes for a warm, hearty meal anywhere and anytime\\nA delicious combination of white meat chicken, carrots, celery and peas in a golden, flaky crust\\nA frozen dinner made without artificial flavors, colors or preservatives\\nHeat this frozen meal in the microwave for 5 to 6 1/2 minutes or in the oven for 50 minutes and let stand for 5 minutes\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/91jKK+al1xL._AC_UL320_.jpg\",\"name\":\"Marie Callender's Chicken Pot Pie\",\"price\":2.99,\"rating\":3},{\"id\":37,\"category\":\"Frozen Foods\",\"description\":\"Brought to you by Whole Foods Market. When it comes to innovative flavors and products sourced from artisans and producers around the world, the Whole Foods Market brand has you covered. Amazing products, exceptional ingredients, no compromises.\\nOur Gnocchi alla Sorrentina is the real thing. Made in Mongrassano, Italy, each \\\"gnocco\\\" (a single dumpling) is made using the age-old combination of durum wheat semolina and potato, for a soft, dense, texture that is sure to satisfy.\\nItalian cuisine.\\nReady in 5-7 minutes.\\nCertified Vegetarian.\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/71P5jv23IWL._AC_UL320_.jpg\",\"name\":\"Whole Foods Market, Gnocchi alla Sorrentina\",\"price\":3.79,\"rating\":4},{\"id\":38,\"category\":\"Frozen Foods\",\"description\":\"RED BARON DEEP DISH SINGLE PEPPERONI PIZZA is made with zesty tomato sauce, 100% real cheese, and a hearty topping of pepperoni\\nDEEP DISH SINGLE PIZZA is made on our crispy, buttery crust that is the perfect size for lunch or dinner\\nEASY TO PREPARE MEAL - just cook frozen pizzas in the microwave for 2-3 minutes\\nNEVER FLY SOLO - RED BARON\",\"discount\":2,\"imageUrl\":\"https://m.media-amazon.com/images/I/710pNecmiML._AC_UL320_.jpg\",\"name\":\"Red Baron Deep Dish Singles Pepperoni Pizza\",\"price\":3.99,\"rating\":3},{\"id\":39,\"category\":\"Frozen Foods\",\"description\":\"DELICIOUS FLAVOR Our flavorful shrimps are peeled and deveined before being dipped in our mouth-watering, golden, crispy breading for a scrumptious flavor that your whole family will love.\\nQUICK ANDCONVENIENT SeaPak frozen shrimp is the ideal solution for people who are short on time but still want a seafood meal.\\nMULTIPLE COOKING OPTIONS Our scrumptious shrimp can be prepared a number of ways for your convenience. Bake or fry them, these large breaded shellfish are a favorite no matter how they are cooked!\\nSUSTAINABILITY We believe that producing great seafood shouldn't come at the expense of the environment. That's why SeaPak sources only from suppliers who work to limit environmental impact and harvest responsibly.\\nCHILLAX, YOU'VE GOT THIS SeaPak offers a number of frozen seafood options that are both tasty and quick, so you can relax and use your time for other things.\",\"discount\":40,\"imageUrl\":\"https://m.media-amazon.com/images/I/71mjzUmNCgL._AC_UL320_.jpg\",\"name\":\"SeaPak Jumbo Butterfly Shrimp with Oven Crispy Breading\",\"price\":8.99,\"rating\":5},{\"id\":40,\"category\":\"Frozen Foods\",\"description\":\"Brought to you by Whole Foods Market. When it comes to innovative flavors and products sourced from artisans and producers around the world, the Whole Foods Market brand has you covered. Amazing products, exceptional ingredients, no compromises.\\nOur Penne all'Arrabbiata is far more delicious than it is angry. Made in Mongrassano, Italy, each \\\"penna\\\" is made using bronze-cut durum wheat semolina dough, for that homemade pasta texture that is sure to satisfy.\\nItalian cuisine.\\nReady in 5-7 minutes.\\nCertified Vegetarian.\",\"discount\":20,\"imageUrl\":\"https://m.media-amazon.com/images/I/71TJW3qZkML._AC_UL320_.jpg\",\"name\":\"Whole Foods Market, Penne all'Arrabbiata\",\"price\":3.99,\"rating\":2},{\"id\":41,\"category\":\"Fruits\",\"description\":\"32-ounce container of cubed pineapple\\nReady to eat\\nNo preservatives\\nGreat for on-the-go snacking\\nOur Fresh brand products are all about high-quality food that fits every budget, every day.\",\"discount\":30,\"imageUrl\":\"https://m.media-amazon.com/images/I/71lyLwLJIaL._AC_UL320_.jpg\",\"name\":\"Fresh Brand – Cubed Pineapple\",\"price\":6.55,\"rating\":4},{\"id\":42,\"category\":\"Fruits\",\"description\":\"Delivered at peak freshness year-round.\\nFamily Farmer Owned since 1930.\\nA quick & healthy bite size snack.\\nBrands may vary by region\\nConventionally grown in the United States, Chile, Peru, or Mexico.\\nWash before consuming\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/71t+1fmA1YL._AC_UL320_.jpg\",\"name\":\"Ocean Spray Red Seedless Grapes\",\"price\":4.51,\"rating\":5},{\"id\":43,\"category\":\"Fruits\",\"description\":\"Delivered at peak freshness year-round.\\nFamily Farmer Owned since 1930.\\nA quick & healthy bite size snack.\\nBrands my vary by region\\nConventionally grown in the United States, Chile, Peru, or Mexico.\\nWash before consuming\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/41xZYav0U6L.jpg\",\"name\":\"Ocean Spray Green Seedless Grapes\",\"price\":4.2,\"rating\":4},{\"id\":44,\"category\":\"Fruits\",\"description\":\"Grown in the US\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/81eQAtUFO4L._AC_UL320_.jpg\",\"name\":\"Bartlett Pears\",\"price\":4.39,\"rating\":4.5},{\"id\":45,\"category\":\"Fruits\",\"description\":\"Mango is a low-calorie fruit that is high in fiber, and is a great source of vitamins A and C\\nTo Prepare: Using a sharp knife, place the mango on a stable surface and slice the mango lengthwise on either side of the pit. Score a lattice into the flesh, being careful not to cut through the skin. Gently push out the flesh, slice off the cubes and discard the skin\\nMango can be stored at room temperature when whole, once sliced wrap and store in the refrigerator or freezer\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/81quGLspRAL._AC_UL320_.jpg\",\"name\":\"Red Mango\",\"price\":1.69,\"rating\":5},{\"id\":46,\"category\":\"Fruits\",\"description\":\"This tropical fruit is often described as having the flavor of a super-sweet hybrid between a kiwi and a pear\\nTo enjoy, simply slice in half length-wise and scoop out the inner flesh with a spoon\\nStore this fruit at room temperature when whole, or in the refrigerator in a sealed container once sliced\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/71cwOKZ-l6L._AC_UL320_.jpg\",\"name\":\"Dragon Fruit (Pitahaya)\",\"price\":6.99,\"rating\":3},{\"id\":47,\"category\":\"Fruits\",\"description\":\"Wash before consuming\\nGrown in the United States, Chile, or Mexico\\nDelicious on their own as a healthy snack or as part of a recipe\\nStore in the refrigerator for maximum shelf life\",\"discount\":10,\"imageUrl\":\"https://m.media-amazon.com/images/I/8143FLAy6GL._AC_UL320_.jpg\",\"name\":\"Strawberries\",\"price\":3.87,\"rating\":5},{\"id\":48,\"category\":\"Fruits\",\"description\":\"Selected and stored fresh\\nSourced with high quality standards\\nRecommended to wash before consuming\\nDelicious on their own as a healthy snack or as part of a recipe\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/81VfV+MiJ0L._AC_UL320_.jpg\",\"name\":\"Mini Seedless Watermelon Organic\",\"price\":4.99,\"rating\":4},{\"id\":49,\"category\":\"Fruits\",\"description\":\"Wash before consuming\\nGrown in United States, Argentina, Mexico, Uruguay, Chile, Peru, or Canada\\nDelicious on their own or with other foods\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/71xSGViUzGL._AC_UL320_.jpg\",\"name\":\"Blueberries\",\"price\":3.59,\"rating\":5},{\"id\":50,\"category\":\"Fruits\",\"description\":\"Grown in United States, Mexico, Argentina, Canada, Uruguay, Morocco, Spain, South Africa, or Peru\\nGrown in United States\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/81BPouGvNIL._AC_UL320_.jpg\",\"name\":\"Mandarin Oranges\",\"price\":6.77,\"rating\":4},{\"id\":51,\"category\":\"Meat and Seafood\",\"description\":\"4 (6 oz.) Wild Alaskan Skin-On Sockeye Salmon\\n4 (6 oz.) Marinated Salmon Fillets\\n1 (18 oz. pkg.) Pub-Style Cod\\n1 (1.5 lbs. pkg.) Jumbo Cooked Shrimp\\nAs FIFTH generation family owners, we promise every ounce of Omaha Steaks you serve your family is of the best quality & safety.\",\"discount\":40,\"imageUrl\":\"https://m.media-amazon.com/images/I/81KE4GYoM-L._AC_UL320_.jpg\",\"name\":\"Omaha Steaks\",\"price\":149.99,\"rating\":5},{\"id\":52,\"category\":\"Meat and Seafood\",\"description\":\"\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/51NG7vclRoL._AC_UL320_.jpg\",\"name\":\"lobster claw and knuckle mea\",\"price\":159.99,\"rating\":2},{\"id\":53,\"category\":\"Meat and Seafood\",\"description\":\"Lobster & Filet Mignon isn’t just a delicious meal – it’s a fun experience that you, your family, or that special someone will never forget. A perfect reward for your employees or clients, or to simply treat yourself to a tasty dinner at home.\\nLobster Gram takes pride in offering Our customers the freshest and tastiest lobster tail dinners, freshly caught in the cold, North Atlantic waters off biddeford, Maine, and shipped fresh from our shore to your door.\\nLobster Gram certifies that each lobster tail were fished using 100% sustainable sources and methods. All abide by the lobster conservation code of conduct in order to ensure a healthy, sustainable resource and a vital fishery.\\nLobster Gram steaks are cold-aged for a minimum of 21 days to ensure maximum flavor potential & melt-in-your-mouth tenderness. Our steaks are procured from the same butchers that serve 5-star steakhouses, a perfect complements to our lobster tails.\\nFresh “from our shore to your door” since 1987, Lobster Gram stays true to its roots and earned the reputation for being the #1 lobster, seafood and gourmet food Delivery company in the country. Product shipped in dry ice to keep product frozen.\",\"discount\":80,\"imageUrl\":\"https://m.media-amazon.com/images/I/41Z4LJgnNoL._AC_UL320_.jpg\",\"name\":\"Lobster Gram\",\"price\":167.99,\"rating\":4},{\"id\":54,\"category\":\"Meat and Seafood\",\"description\":\"A TASTY APPETIZER – Lobster Gram takes pride in offering our customers the freshest and tastiest snow crab cocktail claws, with a perfect balance of flavor. The ideal sweet, succulent appetizer!\\nREADY TO SERVE, EASY TO SHARE – Conveniently ready to thaw and serve - our snow crab claws make the perfect finger food, complete with their own built-in handle.\\nPACKAGED FRESH - We ship frozen snow crab claws by packaging them in dry ice. This keeps them frozen during shipping (fresh-frozen). The snow crab claws were caught, cut, and packaged fresh.\\nFROM THE SHORE TO YOUR DOOR - Fresh “from our shore to your door” since 1987, Lobster Gram has worked tirelessly to stay true to its roots and earn the reputation for being the #1 lobster, seafood and gourmet food gift delivery company in the country.\\nLOBSTER GRAM – Seafood isn’t just a delicious meal – it’s a fun experience that you, your family, or that special someone will never forget. Perfect to delight your family, reward your employees or clients, or simply treat yourself to a tasty dinner at home.\",\"discount\":10,\"imageUrl\":\"https://m.media-amazon.com/images/I/71LZXwovlsL._AC_UL320_.jpg\",\"name\":\"Lobster Gram - 2 Pounds Jumbo Snow Crab\",\"price\":176.15,\"rating\":3},{\"id\":55,\"category\":\"Meat and Seafood\",\"description\":\"FREE NEXT DAY SHIPPING (Received before 4:00pm EST)\\nFRESH PICKED DAILY\\nDIY KIT for Dinner Party\\nInstructions Included\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/812YfCfqsQL._AC_UL320_.jpg\",\"name\":\"Maine Lobster Roll kit\",\"price\":159.99,\"rating\":5},{\"id\":56,\"category\":\"Meat and Seafood\",\"description\":\"Meets standards for animal welfare, feed, and more, so you can know about what you're buying (and eating)\\nNo added growth hormones or antibiotics, ever\\nNo animal by-products in feed\\nTraceable to farm or ranch.\\nAnimal Welfare Certified by Global Animal Partnership\",\"discount\":30,\"imageUrl\":\"https://m.media-amazon.com/images/I/51vJoFPHR0L._AC_UL320_.jpg\",\"name\":\"Beef Ribeye Steak Boneless Dry Aged\",\"price\":24.99,\"rating\":3},{\"id\":57,\"category\":\"Meat and Seafood\",\"description\":\"Crab cakes are made to order, just as they are at Jimmy's Famous Seafood\\nCrab cakes will arrive individually packaged, complete with directions for refrigeration, freezing, or cooking.\",\"discount\":60,\"imageUrl\":\"https://m.media-amazon.com/images/I/710MRP4UkLL._AC_UL320_.jpg\",\"name\":\"4 (8oz) Jumbo Lump/Colossal Jimmys Famous Seafood Maryland Crab Cakes\",\"price\":180,\"rating\":3},{\"id\":58,\"category\":\"Meat and Seafood\",\"description\":\"Maine Lobster Tails - Fresh, Flash Frozen Lobster Tails (12 lobster tails | 4 -5 Oz Each). Our live Maine lobsters are caught by the women and men of Maine dedicated to preserving the sustainability of the Maine lobster industry and engage in practices that ensure its health and vitality. Each lobster is hand-selected with care and humanely by experienced lobster-handling experts and packaged with sustainable, environmentally-friendly materials.\\nPrepare with durable, thick and stainless steel seafood scissors, crab leg crackers, and lobster crackers tools. Use lobster clasp for lobster claw meat\\nEat with seafood forks, crab leg forks or lobster picks. Great with seafood seasoning!\\nWild Caught, Antibiotic-Free Lobster. Can be frozen in freezer. Simply Thaw and Prepare.\\nCooking Instructions Included - Bake, Boil, Broil, Pan Seared, Steam, and even Grill your Lobster Tails, Lobster Claws and Fresh Lobster Meat. Satisfaction guaranteed for your taste buds!\",\"discount\":80,\"imageUrl\":\"https://m.media-amazon.com/images/I/71csRK2iwvL._AC_UL320_.jpg\",\"name\":\"Fresh Frozen Lobster Tails from Maine\",\"price\":106,\"rating\":3},{\"id\":59,\"category\":\"Meat and Seafood\",\"description\":\"5 lbs. Conch Meat\\nSucculent conch meat. A Caribbean favorite that you're sure to enjoy.\",\"discount\":10,\"imageUrl\":\"https://m.media-amazon.com/images/I/91kOHMzDP1L._AC_UL320_.jpg\",\"name\":\"Conch Meat, Cleaned and Filleted\",\"price\":149.33,\"rating\":2},{\"id\":60,\"category\":\"Meat and Seafood\",\"description\":\"20 oz. USDA Choice Bone-In Ribeye Steaks (Individually sealed)\\nHand-cut quality and aged to perfection\\nWell marbled, tender, and on the bone for extra flavor\\nSteaks will arrive in a Styrofoam cooler, packaged with dry ice\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/61Z838Jm+CL._AC_UL320_.jpg\",\"name\":\"Bone-in Ribeyes + Seasoning \",\"price\":159.99,\"rating\":1},{\"id\":61,\"category\":\"Vegetables\",\"description\":\"8-ounce package of sliced baby bella mushrooms\\nNo preservatives\\nPre-sliced to reduce prep time\\nOur Fresh brand products are all about high-quality food that fits every budget, every day.\",\"discount\":10,\"imageUrl\":\"https://m.media-amazon.com/images/I/81oQzhdCjxL._AC_UL320_.jpg\",\"name\":\"Fresh Brand – Sliced Baby Bella Mushrooms\",\"price\":1.55,\"rating\":3},{\"id\":62,\"category\":\"Vegetables\",\"description\":\"365 by Whole Foods Market products give you that dance-down-the-aisles feeling, virtual aisles too! Our huge range of choices with premium ingredients at prices you can get down with makes grocery shopping so much more than tossing the basics in your cart.\",\"discount\":20,\"imageUrl\":\"https://m.media-amazon.com/images/I/81cql-XR7JL._AC_UL320_.jpg\",\"name\":\"Everyday Value, Organic Trimmed Green Beans\",\"price\":3.99,\"rating\":2},{\"id\":63,\"category\":\"Vegetables\",\"description\":\"365 by Whole Foods Market products give you that dance-down-the-aisles feeling, virtual aisles too! Our huge range of choices with premium ingredients at prices you can get down with makes grocery shopping so much more than tossing the basics in your cart.\",\"discount\":30,\"imageUrl\":\"https://m.media-amazon.com/images/I/81L1Bn6u6tL._AC_UL320_.jpg\",\"name\":\"Whole Foods Market, Cauliflower Florets\",\"price\":2.59,\"rating\":4},{\"id\":64,\"category\":\"Vegetables\",\"description\":\"Selected and stored fresh\\nSourced with high quality standards\\nRecommended to wash before consuming\\nDelicious on their own as a healthy snack or as part of a recipe\",\"discount\":50,\"imageUrl\":\"https://m.media-amazon.com/images/I/71mYzDfK-6L._AC_UL320_.jpg\",\"name\":\"Broccoli Crowns Conventional\",\"price\":1.99,\"rating\":5},{\"id\":65,\"category\":\"Vegetables\",\"description\":\"Del Monte Asparagus Spears are the perfect way to enjoy your favorite seasonal dishes all year long\\nCarefully picked and packed at the peak of freshness by our expert growers; our produce is non-GMO with non-BPA intent\\nSimply crafted with just three simple ingredients: asparagus, water and sea salt\\nOur asparagus has a deliciously fresh taste that works great as a stand-alone accompaniment or a delicious ingredient\\nConvienent 12-pack of 15-ounce cans\",\"discount\":60,\"imageUrl\":\"https://m.media-amazon.com/images/I/81kXfjlZ-TS._AC_UL320_.jpg\",\"name\":\"Del Monte Canned Extra Long Asparagus Spears\",\"price\":38.28,\"rating\":4},{\"id\":66,\"category\":\"Vegetables\",\"description\":\"Heads up! This product’s package is getting a makeover, transitioning from Whole Foods Market to 365 brand. Best of all, it’s the same deliciousness on the inside\\nSelected and stored fresh Sourced with high quality standards Sourced with high quality standards\\nRecommended to wash before consuming\\nDelicious on their own as a healthy snack or as part of a recipe\",\"discount\":10,\"imageUrl\":\"https://m.media-amazon.com/images/I/81uy4iuhG9L._AC_UL320_.jpg\",\"name\":\"Salad Clm Spinach Organic\",\"price\":5.49,\"rating\":5},{\"id\":67,\"category\":\"Vegetables\",\"description\":\"16-ounce (1-pound) bag of cut and peeled baby carrots\\nNo preservatives\\nCertified Non-GMO\\nGrown in the United States\\nOur Fresh brand products are all about high-quality food that fits every budget, every day.\",\"discount\":20,\"imageUrl\":\"https://m.media-amazon.com/images/I/716s9vkPTSL._AC_UL320_.jpg\",\"name\":\"Fresh Brand – Cut and Peeled Baby Carrots\",\"price\":1.69,\"rating\":1},{\"id\":68,\"category\":\"Vegetables\",\"description\":\"5-pound bag of gold potatoes\\nNo preservatives\\nGrown in the United States\\nGood for roasting, pan-frying, and smashing\\nOur Fresh brand products are all about high-quality food that fits every budget, every day.\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/819fIpwZNbL._AC_UL320_.jpg\",\"name\":\"Fresh Brand – Gold Potatoes\",\"price\":3.99,\"rating\":5},{\"id\":69,\"category\":\"Vegetables\",\"description\":\"Brought to you by Whole Foods Market. Our standards are what set us apart, and our quality is what keeps us stocking pantries, fridges and freezers with the best natural and organic 365 Everyday Value products every day.\\nMicrowave steamable in bag.\\nGreat for recipes.\\nPre-washed.\\nCertified GMO-Free, Certified Vegan.\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/81xJ7fVSC2L._AC_UL320_.jpg\",\"name\":\"Trimmed Brussels Sprouts\",\"price\":2.99,\"rating\":5},{\"id\":70,\"category\":\"Vegetables\",\"description\":\"Selected and stored fresh\\nSourced with high quality standards\\nRecommended to wash before consuming\\nDelicious on their own as a healthy snack or as part of a recipe\",\"discount\":0,\"imageUrl\":\"https://m.media-amazon.com/images/I/81v28JVHvsL._AC_UL320_.jpg\",\"name\":\"Organic Vegetable Tray\",\"price\":6.99,\"rating\":4}]";

    public List<Grocery> getGroceries(String category, String sortBy, double rating, int discount, String storeId) {
    	log.info("Getting all grocessiries");
    	try {
    	InetAddress address = InetAddress.getLocalHost();
        String ip = address.getHostAddress();
        log.info("IP Address = " + ip);
    	} catch (UnknownHostException e) {
            e.printStackTrace();
        }

    	List<Grocery> g = groceryRepository.getGroceries(category, rating, discount, storeId, Sort.by(sortBy.equals("asc") ? Sort.Direction.ASC : Sort.Direction.DESC, "price"));
    	log.info("Grocessiries: {}",g);
    	return g;
    }

    public Grocery getGrocery(Integer id) {
        return groceryRepository.findById(id).get();
    }

    public List<Grocery> getAllGroceries() {
        return groceryRepository.findAll();
    }

    public List<Stores> getStores() {
        return storeRepository.findAll(Sort.by(Sort.Direction.DESC, "reviewCount", "rating"));
    }

    public List<Stores> getNearByStores(double lat, double lon) {
        String s = "POINT(" + lat + " " + lon + ")";
        return storeRepository.getNearByStores(s);
    }

    public Grocery saveGrocery(Grocery grocery) {
        grocery.setCreated_date(LocalDateTime.now());
        return groceryRepository.save(grocery);
    }


    public void deleteGrocery(Integer id) {
        groceryRepository.deleteById(id);
    }

    public Stores getNearMeStores(double lat, double lon) {
        String s = "POINT(" + lat + " " + lon + ")";
        return storeRepository.getNearMeStores(s);
    }
    public List<Stores> searchStores(String s) {
    	return storeRepository.searchStores(s);
    }

    public GroceryReview reviewGrocery(Integer id, GroceryReview review) {
        Grocery grocery = groceryRepository.findById(id).get();

        review.setGroceryId(grocery.getId());
        review.setGroceryName(grocery.getName());
        review.setStoreId(grocery.getStore().getId());
        review.setPrice(grocery.getPrice());
        review.setStoreName(grocery.getStore().getName());
        review.setUserId(sessionService.getUserInfo().getId());
        review.setUserName(sessionService.getUserInfo().getName());
        review.setCity(grocery.getStore().getCity());
        review.setZipcode(grocery.getStore().getZipCode());

        review = reviewRepository.save(review);


        List<GroceryReview> allByGroceryId = reviewRepository.findAllByGroceryId(id);
        double newRating = allByGroceryId.stream().mapToInt(GroceryReview::getRating).average().orElse(0d);
        grocery.setRating(newRating);
        groceryRepository.save(grocery);

        return review;
    }

    public List<GroceryReview> getGroceryReviews(Integer id) {
        return reviewRepository.findAllByGroceryId(id);
    }

    public Map<String, Long> getCountStat() {
        Map<String, Long> count = new HashMap<>();

        count.put("totalCustomers", userInfoRepository.count());
        count.put("totalProducts", groceryRepository.count());
        count.put("totalOrders", orderRepository.count());
        count.put("totalStores", storeRepository.count());
        count.put("totalReviews", reviewRepository.count());

        return count;
    }

    public String formatDate(LocalDateTime date) {
        return date.format(formatter);
    }

    public List<ChartPoint> getOrderTrend(LocalDateTime startDate, LocalDateTime endDate) {

        long numOdDays = startDate.until(endDate, DAYS) + 1;
        Map<String, Long> orderTrend = orderRepository.getOrderTrend().stream().collect(Collectors.toMap(d -> formatDate((LocalDateTime) d[0]), d -> (Long) d[1]));
        return Stream.iterate(startDate, date -> date.plusDays(1))
                .limit(numOdDays)
                .map(d -> d.truncatedTo(ChronoUnit.DAYS))
                .map(d -> new ChartPoint(formatDate(d), orderTrend.getOrDefault(formatDate(d), 0L)))
                .collect(Collectors.toList());
    }

    public List<ChartPoint> getOrderByPinCode(LocalDateTime startDate, LocalDateTime endDate) {
        return orderRepository.getOrderByPinCode();
    }

    public List<ChartPoint> topRatedProducts() {
        List<ChartPoint> chartPoints = groceryRepository.topRated();
        return chartPoints.subList(0, Math.min(chartPoints.size(), 10));
    }

    public List<Grocery> reviewDataFilter(String sortBy, int rating, int discount, String storeId) {
        return null;
    }

    public String createData() {

        Gson gson = new Gson();

        Type listType = new TypeToken<ArrayList<Grocery>>() {
        }.getType();
        List<Grocery> groceries = new Gson().fromJson(demoData, listType);
        Random ran = new Random();
        storeRepository.findAll().forEach(
                store -> {
                    List<Grocery> gcr = groceries.stream().map(d -> {
                                try {
                                    return (Grocery) d.clone();
                                } catch (CloneNotSupportedException e) {
                                    return null;
                                }
                            }).filter(Objects::nonNull)
                            .peek(d -> d.setId(null))
                            .peek(d -> d.setCreated_date(LocalDateTime.now().minusDays(ran.nextInt(15))))
                            .peek(d -> d.setAvailableCount(ran.nextInt(15)))
                            .peek(d -> d.setStore(store))
                            .collect(Collectors.toList());
                    groceryRepository.saveAll(gcr);
                }
        );

        return "Done";
    }

    public List<Grocery> recentlyAdded() { 
    	List<Grocery> l=null;
    	try {
    		l= groceryRepository.recentlyAdded(LocalDateTime.now().minusDays(7), LocalDateTime.now());
    		System.out.println("size of list is : "+l.size());
    	}
    	
    	catch(Exception e) {
    		System.out.println("Error : "+e);
    	}
    	return l;
    }

    public List<Grocery> getAllGroceries(String searchText) {
        return groceryRepository.search(searchText);
    }

    public Object reviewStats(ReviewFilter filter) {
        Query query = new Query();
        query.addCriteria("Greater Than".equals(filter.ratingFilter) || filter.rating == 0 ? Criteria.where("rating").gt(filter.rating) : Criteria.where("rating").is(filter.rating));

        if (filter.pid != 0) {
            query.addCriteria(Criteria.where("groceryId").is(filter.pid));
        }

        if (filter.price > 0) {
            switch (filter.priceFilter) {
                case "Greater Than":
                    query.addCriteria(Criteria.where("price").gt(filter.price));
                    break;
                case "Less Than":
                    query.addCriteria(Criteria.where("price").lt(filter.price));
                    break;
                default:
                    query.addCriteria(Criteria.where("price").is(filter.price));
                    break;
            }
        }

        if (filter.zipCode != null && !filter.zipCode.isEmpty()) {
            query.addCriteria(Criteria.where("zipcode").is(filter.zipCode));
        }
        List<GroceryReview> groceryReviews = mongoTemplate.find(query, GroceryReview.class);

        Object res = groceryReviews;

        if(filter.groupBy != null && !filter.groupBy.isEmpty()) {
            res = groceryReviews.stream().filter(d -> d.getCity() != null).collect(
                    Collectors.groupingBy(d -> "City".equals(filter.groupBy) ? d.getCity() : d.getGroceryName(), Collectors.mapping(d -> d, Collectors.toList())));

            if(filter.groupType == null || filter.groupType.isEmpty() || "Count".equals(filter.groupType)) {
                res = groceryReviews.stream().filter(d -> d.getCity() != null).collect(
                        Collectors.groupingBy(d -> "City".equals(filter.groupBy) ? d.getCity() : d.getGroceryName(), Collectors.counting()));
            }
        }


        return res;
    }

    public List<ChartPoint> orderSalesTrend(LocalDateTime startDate, LocalDateTime endDate) {

        long numOdDays = startDate.until(endDate, DAYS) + 1;
        Map<String, Double> orderTrend = orderRepository.getOrderSalesTrend().stream().collect(Collectors.toMap(d -> formatDate((LocalDateTime) d[0]), d -> (Double) d[1]));
        return Stream.iterate(startDate, date -> date.plusDays(1))
                .limit(numOdDays)
                .map(d -> d.truncatedTo(ChronoUnit.DAYS))
                .map(d -> new ChartPoint(formatDate(d), orderTrend.getOrDefault(formatDate(d), 0d)))
                .collect(Collectors.toList());
    }
}
